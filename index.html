<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯ÙØªØ± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø°ÙƒÙŠ</title>
<style>
    body {
        font-family: "Cairo", sans-serif;
        background-color: #2f2f2f;
        color: white;
        text-align: center;
        padding: 20px;
    }

    input, select {
        padding: 8px;
        margin: 5px;
        border-radius: 8px;
        border: none;
        width: 140px;
    }

    button {
        background-color: #7e57c2;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 10px;
        margin: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    button:hover {
        background-color: #9c6df0;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background-color: #3d3d3d;
        border-radius: 10px;
        overflow: hidden;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #555;
    }

    .income { color: #4caf50; }
    .expense { color: #ff5252; }

    .summary, .monthly-summary {
        background-color: #444;
        padding: 10px;
        border-radius: 10px;
        margin-top: 15px;
        text-align: center;
    }

    .summary strong, .monthly-summary strong {
        color: #ffc107;
    }

    .chart-area {
        margin-top: 25px;
        padding: 15px;
        background-color: #383838;
        border-radius: 12px;
    }

    canvas {
        background: #2a2a2a;
        border-radius: 10px;
        margin-top: 10px;
        width: 100%;
        max-height: 300px;
    }

    .select-box {
        transform: scale(1.2);
    }
</style>
</head>
<body>

<h2>ğŸ’¼ Ø¯ÙØªØ± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø°ÙƒÙŠ</h2>

<input type="text" id="desc" placeholder="Ø§Ù„Ø¨ÙŠØ§Ù†">
<select id="type">
    <option value="Ø¯Ø®Ù„">Ø¯Ø®Ù„</option>
    <option value="Ø®Ø±ÙˆØ¬">Ø®Ø±ÙˆØ¬</option>
</select>
<input type="number" id="amount" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©">
<input type="date" id="date">
<br>
<button onclick="addTransaction()">Ø¥Ø¶Ø§ÙØ©</button>

<table id="records">
    <tr>
        <th>Ø§Ù„Ø±Ù‚Ù…</th>
        <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
        <th>Ø§Ù„Ù†ÙˆØ¹</th>
        <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
    </tr>
</table>

<div class="summary">
    ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„: <strong id="totalIncome">0</strong> |
    ğŸ’¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ: <strong id="totalExpenses">0</strong> |
    ğŸ§® Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØµØ§ÙÙŠ: <strong id="netBalance">0</strong>
</div>

<div class="monthly-summary">
    <h3>ğŸ“Š Ù…Ù„Ø®Øµ Ø´Ù‡Ø±ÙŠ</h3>
    <div id="monthlyStats">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</div>
</div>

<div class="chart-area">
    <h3>ğŸ“ˆ ØªØ·ÙˆØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
    <canvas id="chart"></canvas>
</div>

<button onclick="enableSelection()">ğŸ—‘ï¸ Ø§Ø®ØªØ± Ù„Ù„Ø­Ø°Ù</button>
<button onclick="clearAll()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
<button onclick="printPage()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    let selectionMode = false;

    function saveData() {
        localStorage.setItem("transactions", JSON.stringify(transactions));
    }

    function renderTable() {
        const table = document.getElementById("records");
        table.innerHTML = `
            <tr>
                <th>Ø§Ù„Ø±Ù‚Ù…</th>
                <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                ${selectionMode ? "<th>Ø§Ø®ØªÙŠØ§Ø±</th>" : ""}
            </tr>
        `;

        let totalIncome = 0;
        let totalExpenses = 0;

        transactions.forEach((t, i) => {
            const row = document.createElement("tr");
            const cls = t.type === "Ø¯Ø®Ù„" ? "income" : "expense";
            row.innerHTML = `
                <td>${i}</td>
                <td>${t.desc}</td>
                <td class="${cls}">${t.type}</td>
                <td>${t.amount}</td>
                <td>${t.date}</td>
                ${selectionMode ? `<td><input type='checkbox' class='select-box' data-index='${i}'></td>` : ""}
            `;
            table.appendChild(row);

            if (t.type === "Ø¯Ø®Ù„") totalIncome += t.amount;
            else totalExpenses += t.amount;
        });

        const net = totalIncome - totalExpenses;
        document.getElementById("totalIncome").textContent = totalIncome;
        document.getElementById("totalExpenses").textContent = totalExpenses;
        document.getElementById("netBalance").textContent = net;
        renderMonthlyStats();
    }

    function addTransaction() {
        const desc = document.getElementById("desc").value.trim();
        const type = document.getElementById("type").value;
        const amount = parseFloat(document.getElementById("amount").value);
        const date = document.getElementById("date").value || new Date().toISOString().split("T")[0];

        if (!desc || isNaN(amount)) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù† ÙˆØ§Ù„Ù‚ÙŠÙ…Ø©!");

        transactions.push({ desc, type, amount, date });
        saveData();
        renderTable();

        document.getElementById("desc").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("date").value = "";
    }

    function renderMonthlyStats() {
        const stats = {};
        transactions.forEach(t => {
            const month = t.date.slice(0, 7); // YYYY-MM
            if (!stats[month]) stats[month] = { income: 0, expense: 0 };
            if (t.type === "Ø¯Ø®Ù„") stats[month].income += t.amount;
            else stats[month].expense += t.amount;
        });

        const container = document.getElementById("monthlyStats");
        container.innerHTML = "";

        const months = Object.keys(stats);
        if (months.length === 0) {
            container.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯";
            return;
        }

        let labels = [], data = [];

        months.forEach(m => {
            const net = stats[m].income - stats[m].expense;
            labels.push(m);
            data.push(net);

            const color = net >= 0 ? "green" : "red";
            const div = document.createElement("div");
            div.innerHTML = `${m}: <span style="color:${color}">${net >= 0 ? "Ø±Ø¨Ø­" : "Ø®Ø³Ø§Ø±Ø©"} ${net}</span>`;
            container.appendChild(div);
        });

        renderChart(labels, data);
    }

    function renderChart(labels, data) {
        const ctx = document.getElementById("chart").getContext("2d");
        if (window.chartInstance) window.chartInstance.destroy();
        window.chartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ØµØ§ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©',
                    data: data,
                    backgroundColor: data.map(v => v >= 0 ? '#4caf50' : '#ff5252'),
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    function enableSelection() {
        selectionMode = !selectionMode;
        renderTable();
        const btn = document.querySelector('button[onclick="enableSelection()"]');
        btn.textContent = selectionMode ? "ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯" : "ğŸ—‘ï¸ Ø§Ø®ØªØ± Ù„Ù„Ø­Ø°Ù";
        if (selectionMode) btn.onclick = deleteSelected;
        else btn.onclick = enableSelection;
    }

    function deleteSelected() {
        const selected = Array.from(document.querySelectorAll('.select-box:checked')).map(cb => +cb.dataset.index);
        if (selected.length === 0) return alert("Ø§Ø®ØªØ± ØµÙÙˆÙ Ù„Ù„Ø­Ø°Ù Ø£ÙˆÙ„Ø§Ù‹!");
        if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŸ")) return;

        transactions = transactions.filter((_, i) => !selected.includes(i));
        saveData();
        selectionMode = false;
        renderTable();
        const btn = document.querySelector('button[onclick="deleteSelected()"]');
        btn.textContent = "ğŸ—‘ï¸ Ø§Ø®ØªØ± Ù„Ù„Ø­Ø°Ù";
        btn.onclick = enableSelection;
    }

    function clearAll() {
        if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
            transactions = [];
            saveData();
            renderTable();
        }
    }

    function printPage() {
        window.print();
    }

    renderTable();
</script>

</body>
</html>
